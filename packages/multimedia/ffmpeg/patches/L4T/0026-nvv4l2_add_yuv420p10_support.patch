From 9b72b7927b8f854e4ab5f7da1ed8607b435b7ec1 Mon Sep 17 00:00:00 2001
From: CTCaer <ctcaer@gmail.com>
Date: Sun, 2 Jul 2023 03:23:34 +0000
Subject: [PATCH] nvv4l2: add yuv420p10 support NVENC supports yuv420p10 as
 p010.

---
 libavcodec/nvv4l2_enc.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/libavcodec/nvv4l2_enc.c b/libavcodec/nvv4l2_enc.c
index dc09236e0a1..5102bd895da 100644
--- a/libavcodec/nvv4l2_enc.c
+++ b/libavcodec/nvv4l2_enc.c
@@ -1,5 +1,5 @@
 /*
- * Copyright (c) 2021-2022, CTCaer <ctcaer@gmail.com>
+ * Copyright (c) 2021-2023, CTCaer <ctcaer@gmail.com>
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
@@ -1129,6 +1129,8 @@ static int nvv4l2enc_init(AVCodecContext *avctx)
     case AV_PIX_FMT_NV12:
         pix_fmt = V4L2_PIX_FMT_NV12M;
         break;
+    case AV_PIX_FMT_YUV420P10:
+        avctx->pix_fmt = AV_PIX_FMT_P010;
     case AV_PIX_FMT_P010:
         pix_fmt = V4L2_PIX_FMT_P010M;
         break;
@@ -1472,6 +1474,7 @@ static const AVOption options_hevc[] = {
                                                          AV_PIX_FMT_YUV444P,          \
                                                          AV_PIX_FMT_NV12,             \
                                                          AV_PIX_FMT_P010,             \
+                                                         AV_PIX_FMT_YUV420P10,        \
                                                          AV_PIX_FMT_NONE },           \
     };
 
-- 
GitLab

