From e9f9a4d1e997751e5b1c4eda750b2883c2834a35 Mon Sep 17 00:00:00 2001
From: Ronald Brown <rbrown4014@yahoo.com>
Date: Fri, 13 Jan 2023 17:42:21 -0800
Subject: [PATCH 1/2] Retroarch: Lakka-Switch: Decouple from LibNX build OC
 menus.

---
 menu/cbs/menu_cbs_deferred_push.c | 11 +-----
 menu/cbs/menu_cbs_get_value.c     |  4 --
 menu/cbs/menu_cbs_left.c          |  4 --
 menu/cbs/menu_cbs_ok.c            | 53 +++----------------------
 menu/cbs/menu_cbs_right.c         |  5 +--
 menu/cbs/menu_cbs_sublabel.c      | 18 ++-------
 menu/cbs/menu_cbs_title.c         | 19 ++-------
 menu/drivers/ozone.c              | 15 +------
 menu/drivers/xmb.c                | 16 +-------
 menu/menu_displaylist.c           | 65 ++-----------------------------
 menu/menu_displaylist.h           |  5 +--
 menu/menu_driver.c                |  4 --
 menu/menu_driver.h                |  5 +--
 menu/menu_setting.c               | 10 ++---
 switch_performance_profiles.h     | 62 +----------------------------
 15 files changed, 29 insertions(+), 267 deletions(-)

diff --git a/menu/cbs/menu_cbs_deferred_push.c b/menu/cbs/menu_cbs_deferred_push.c
index 8f6cca20ff..dee266f9de 100644
--- a/menu/cbs/menu_cbs_deferred_push.c
+++ b/menu/cbs/menu_cbs_deferred_push.c
@@ -261,14 +261,10 @@ GENERIC_DEFERRED_PUSH(deferred_push_core_system_files_list,         DISPLAYLIST_
 GENERIC_DEFERRED_PUSH(deferred_push_lakka_list,                     DISPLAYLIST_LAKKA)
 #endif
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
 GENERIC_DEFERRED_PUSH(deferred_push_switch_cpu_profile,             DISPLAYLIST_SWITCH_CPU_PROFILE)
 #endif
 
-#ifdef HAVE_LAKKA_SWITCH
-GENERIC_DEFERRED_PUSH(deferred_push_switch_gpu_profile,             DISPLAYLIST_SWITCH_GPU_PROFILE)
-#endif
-
 #if defined(HAVE_LAKKA)
 GENERIC_DEFERRED_PUSH(deferred_push_cpu_perfpower,                  DISPLAYLIST_CPU_PERFPOWER_LIST)
 GENERIC_DEFERRED_PUSH(deferred_push_cpu_policy,                     DISPLAYLIST_CPU_POLICY_LIST)
@@ -784,10 +780,7 @@ static int menu_cbs_init_bind_deferred_push_compare_label(
       {MENU_ENUM_LABEL_DEFERRED_AUDIO_RESAMPLER_SETTINGS_LIST, deferred_push_audio_resampler_settings_list},
       {MENU_ENUM_LABEL_DEFERRED_AUDIO_MIXER_SETTINGS_LIST, deferred_push_audio_mixer_settings_list},
       {MENU_ENUM_LABEL_DEFERRED_LATENCY_SETTINGS_LIST, deferred_push_latency_settings_list},
-#ifdef HAVE_LAKKA_SWITCH
-      {MENU_ENUM_LABEL_SWITCH_GPU_PROFILE, deferred_push_switch_gpu_profile},
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if  defined(HAVE_LIBNX)
       {MENU_ENUM_LABEL_SWITCH_CPU_PROFILE, deferred_push_switch_cpu_profile},
 #endif
 #if defined(HAVE_LAKKA)
diff --git a/menu/cbs/menu_cbs_get_value.c b/menu/cbs/menu_cbs_get_value.c
index 45b88b0c2e..67985c1739 100644
--- a/menu/cbs/menu_cbs_get_value.c
+++ b/menu/cbs/menu_cbs_get_value.c
@@ -575,7 +575,6 @@ static void menu_action_setting_disp_set_label_contentless_core(
       strlcpy(s2, alt, len2);
 }
 
-#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
 static void menu_action_setting_disp_cpu_gov_mode(
       file_list_t* list,
@@ -740,7 +739,6 @@ static void menu_action_cpu_governor_label(
    strlcpy(s, d->scaling_governor, len);
 }
 #endif
-#endif
 
 static void menu_action_setting_disp_set_label_core_lock(
       file_list_t* list,
@@ -2012,7 +2010,6 @@ static int menu_cbs_init_bind_get_string_representation_compare_label(
             BIND_ACTION_GET_VALUE(cbs,
                   menu_action_setting_disp_set_label_core_option_override_info);
             break;
-         #ifndef HAVE_LAKKA_SWITCH
          #ifdef HAVE_LAKKA
          case MENU_ENUM_LABEL_CPU_PERF_MODE:
             BIND_ACTION_GET_VALUE(cbs,
@@ -2039,7 +2036,6 @@ static int menu_cbs_init_bind_get_string_representation_compare_label(
             BIND_ACTION_GET_VALUE(cbs, menu_action_cpu_governor_label);
             break;
          #endif
-         #endif
          default:
             return -1;
       }
diff --git a/menu/cbs/menu_cbs_left.c b/menu/cbs/menu_cbs_left.c
index b3c7441bfe..d8b8eb1b01 100644
--- a/menu/cbs/menu_cbs_left.c
+++ b/menu/cbs/menu_cbs_left.c
@@ -686,7 +686,6 @@ static int manual_content_scan_core_name_left(unsigned type, const char *label,
    return 0;
 }
 
-#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
 static int cpu_policy_mode_change(unsigned type, const char *label,
       bool wraparound)
@@ -801,7 +800,6 @@ static int cpu_policy_freq_tweak(unsigned type, const char *label,
    return 0;
 }
 #endif
-#endif /* #ifndef HAVE_LAKKA_SWITCH */
 
 static int core_setting_left(unsigned type, const char *label,
       bool wraparound)
@@ -1115,7 +1113,6 @@ static int menu_cbs_init_bind_left_compare_label(menu_file_list_cbs_t *cbs,
             case MENU_ENUM_LABEL_MANUAL_CONTENT_SCAN_CORE_NAME:
                BIND_ACTION_LEFT(cbs, manual_content_scan_core_name_left);
                break;
-            #ifndef HAVE_LAKKA_SWITCH
             #ifdef HAVE_LAKKA
             case MENU_ENUM_LABEL_CPU_PERF_MODE:
                BIND_ACTION_LEFT(cbs, cpu_policy_mode_change);
@@ -1134,7 +1131,6 @@ static int menu_cbs_init_bind_left_compare_label(menu_file_list_cbs_t *cbs,
                BIND_ACTION_LEFT(cbs, cpu_policy_freq_managed_gov);
                break;
             #endif
-            #endif
             default:
                return -1;
          }
diff --git a/menu/cbs/menu_cbs_ok.c b/menu/cbs/menu_cbs_ok.c
index 0e3d97b821..552408a334 100644
--- a/menu/cbs/menu_cbs_ok.c
+++ b/menu/cbs/menu_cbs_ok.c
@@ -100,7 +100,7 @@
 #include "../../play_feature_delivery/play_feature_delivery.h"
 #endif
 
-#if defined(HAVE_LAKKA) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
 #include "../../switch_performance_profiles.h"
 #endif
 
@@ -3851,19 +3851,11 @@ static int action_ok_deferred_list_stub(const char *path,
    return 0;
 }
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
 static int action_ok_set_switch_cpu_profile(const char *path,
       const char *label, unsigned type, size_t idx, size_t entry_idx)
 {
    char command[PATH_MAX_LENGTH] = {0};
-#ifdef HAVE_LAKKA_SWITCH
-   char* profile_name            = SWITCH_CPU_PROFILES[entry_idx];
-
-   snprintf(command, sizeof(command), "cpu-profile set '%s'", profile_name);
-
-   system(command);
-   snprintf(command, sizeof(command), "Current profile set to %s", profile_name);
-#else
    unsigned profile_clock          = SWITCH_CPU_SPEEDS_VALUES[entry_idx];
    settings_t *settings            = config_get_ptr();
 
@@ -3880,7 +3872,6 @@ static int action_ok_set_switch_cpu_profile(const char *path,
    }
    snprintf(command, sizeof(command),
          "Current Clock set to %i", profile_clock);
-#endif
 
    runloop_msg_queue_push(command, 1, 90, true, NULL,
          MESSAGE_QUEUE_ICON_DEFAULT, MESSAGE_QUEUE_CATEGORY_INFO);
@@ -3889,33 +3880,6 @@ static int action_ok_set_switch_cpu_profile(const char *path,
 }
 #endif
 
-#ifdef HAVE_LAKKA_SWITCH
-
-static int action_ok_set_switch_gpu_profile(const char *path,
-      const char *label, unsigned type, size_t idx, size_t entry_idx)
-{
-   char command[PATH_MAX_LENGTH];
-   char            *profile_name  = SWITCH_GPU_PROFILES[entry_idx];
-
-   command[0]                     = '\0';
-
-   snprintf(command, sizeof(command),
-         "gpu-profile set '%s'",
-         profile_name);
-
-   system(command);
-
-   snprintf(command, sizeof(command),
-         "Current profile set to %s",
-         profile_name);
-
-   runloop_msg_queue_push(command, 1, 90, true, NULL,
-         MESSAGE_QUEUE_ICON_DEFAULT, MESSAGE_QUEUE_CATEGORY_INFO);
-
-   return -1;
-}
-
-#endif
 
 static int action_ok_load_core_deferred(const char *path,
       const char *label, unsigned type, size_t idx, size_t entry_idx)
@@ -8186,10 +8150,8 @@ static int menu_cbs_init_bind_ok_compare_label(menu_file_list_cbs_t *cbs,
 #ifdef HAVE_VIDEO_LAYOUT
          {MENU_ENUM_LABEL_ONSCREEN_VIDEO_LAYOUT_SETTINGS,      action_ok_onscreen_video_layout_list},
 #endif
-#ifdef HAVE_LAKKA_SWITCH
-         {MENU_ENUM_LABEL_SWITCH_GPU_PROFILE,                  action_ok_push_default},
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+
+#if defined(HAVE_LIBNX)
          {MENU_ENUM_LABEL_SWITCH_CPU_PROFILE,                  action_ok_push_default},
 #endif
          {MENU_ENUM_LABEL_MENU_WALLPAPER,                      action_ok_menu_wallpaper},
@@ -8707,12 +8669,7 @@ static int menu_cbs_init_bind_ok_compare_type(menu_file_list_cbs_t *cbs,
          case FILE_TYPE_PLAYLIST_ENTRY:
             BIND_ACTION_OK(cbs, action_ok_playlist_entry_collection);
             break;
-#ifdef HAVE_LAKKA_SWITCH
-         case MENU_SET_SWITCH_GPU_PROFILE:
-            BIND_ACTION_OK(cbs, action_ok_set_switch_gpu_profile);
-            break;
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
          case MENU_SET_SWITCH_CPU_PROFILE:
             BIND_ACTION_OK(cbs, action_ok_set_switch_cpu_profile);
             break;
diff --git a/menu/cbs/menu_cbs_right.c b/menu/cbs/menu_cbs_right.c
index f47ea8c943..396b89064a 100644
--- a/menu/cbs/menu_cbs_right.c
+++ b/menu/cbs/menu_cbs_right.c
@@ -795,7 +795,6 @@ static int manual_content_scan_core_name_right(unsigned type, const char *label,
    return 0;
 }
 
-#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
 static int cpu_policy_mode_change(unsigned type, const char *label,
       bool wraparound)
@@ -913,7 +912,7 @@ static int cpu_policy_freq_tweak(unsigned type, const char *label,
    return 0;
 }
 #endif
-#endif
+
 int core_setting_right(unsigned type, const char *label,
       bool wraparound)
 {
@@ -1240,7 +1239,6 @@ static int menu_cbs_init_bind_right_compare_label(menu_file_list_cbs_t *cbs,
             case MENU_ENUM_LABEL_MANUAL_CONTENT_SCAN_CORE_NAME:
                BIND_ACTION_RIGHT(cbs, manual_content_scan_core_name_right);
                break;
-            #ifndef HAVE_LAKKA_SWITCH
             #ifdef HAVE_LAKKA
             case MENU_ENUM_LABEL_CPU_PERF_MODE:
                BIND_ACTION_RIGHT(cbs, cpu_policy_mode_change);
@@ -1259,7 +1257,6 @@ static int menu_cbs_init_bind_right_compare_label(menu_file_list_cbs_t *cbs,
                BIND_ACTION_RIGHT(cbs, cpu_policy_freq_managed_gov);
                break;
             #endif
-            #endif
             default:
                return -1;
          }
diff --git a/menu/cbs/menu_cbs_sublabel.c b/menu/cbs/menu_cbs_sublabel.c
index 1318337a6d..be2dc7b5fb 100644
--- a/menu/cbs/menu_cbs_sublabel.c
+++ b/menu/cbs/menu_cbs_sublabel.c
@@ -1146,14 +1146,10 @@ DEFAULT_SUBLABEL_MACRO(action_bind_sublabel_show_wimp,
 #endif
 DEFAULT_SUBLABEL_MACRO(action_bind_sublabel_discord_allow,                         MENU_ENUM_SUBLABEL_DISCORD_ALLOW)
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
 DEFAULT_SUBLABEL_MACRO(action_bind_sublabel_switch_cpu_profile,             MENU_ENUM_SUBLABEL_SWITCH_CPU_PROFILE)
 #endif
 
-#ifdef HAVE_LAKKA_SWITCH
-DEFAULT_SUBLABEL_MACRO(action_bind_sublabel_switch_gpu_profile,             MENU_ENUM_SUBLABEL_SWITCH_GPU_PROFILE)
-#endif
-
 #ifdef __linux__
 DEFAULT_SUBLABEL_MACRO(action_bind_sublabel_gamemode_enable,                MENU_ENUM_SUBLABEL_GAMEMODE_ENABLE_LINUX)
 #else
@@ -1296,7 +1292,6 @@ static int action_bind_sublabel_bluetooth_list(
 }
 #endif
 
-#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
 static int action_bind_sublabel_cpu_policy_entry_list(
       file_list_t *list,
@@ -1329,7 +1324,7 @@ static int action_bind_sublabel_cpu_perf_mode(
    return 0;
 }
 #endif
-#endif
+
 #ifdef HAVE_CHEEVOS
 static int action_bind_sublabel_cheevos_entry(
       file_list_t *list,
@@ -4816,14 +4811,12 @@ int menu_cbs_init_bind_sublabel(menu_file_list_cbs_t *cbs,
          case MENU_ENUM_LABEL_TIMEZONE:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_timezone);
             break;
-#ifndef HAVE_LAKKA_SWITCH
          case MENU_ENUM_LABEL_CPU_POLICY_ENTRY:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_cpu_policy_entry_list);
             break;
          case MENU_ENUM_LABEL_CPU_PERF_MODE:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_cpu_perf_mode);
             break;
-#endif
 #endif
          case MENU_ENUM_LABEL_USER_LANGUAGE:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_user_language);
@@ -4913,15 +4906,10 @@ int menu_cbs_init_bind_sublabel(menu_file_list_cbs_t *cbs,
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_show_wimp);
             break;
 #endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
          case MENU_ENUM_LABEL_SWITCH_CPU_PROFILE:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_switch_cpu_profile);
             break;
-#endif
-#ifdef HAVE_LAKKA_SWITCH
-         case MENU_ENUM_LABEL_SWITCH_GPU_PROFILE:
-            BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_switch_gpu_profile);
-            break;
 #endif
          case MENU_ENUM_LABEL_GAMEMODE_ENABLE:
             BIND_ACTION_SUBLABEL(cbs, action_bind_sublabel_gamemode_enable);
diff --git a/menu/cbs/menu_cbs_title.c b/menu/cbs/menu_cbs_title.c
index a47b57d7f8..4f0949c076 100644
--- a/menu/cbs/menu_cbs_title.c
+++ b/menu/cbs/menu_cbs_title.c
@@ -770,14 +770,10 @@ DEFAULT_TITLE_COPY_MACRO(action_get_title_video_shader_preset_save,MENU_ENUM_LAB
 DEFAULT_TITLE_COPY_MACRO(action_get_title_video_shader_preset_remove,MENU_ENUM_LABEL_VALUE_VIDEO_SHADER_PRESET_REMOVE)
 DEFAULT_TITLE_COPY_MACRO(action_get_title_video_shader_preset_save_list,MENU_ENUM_LABEL_VALUE_VIDEO_SHADER_PRESET_SAVE)
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
 DEFAULT_TITLE_MACRO(action_get_title_switch_cpu_profile,          MENU_ENUM_LABEL_VALUE_SWITCH_CPU_PROFILE)
 #endif
 
-#ifdef HAVE_LAKKA_SWITCH
-DEFAULT_TITLE_MACRO(action_get_title_switch_gpu_profile,          MENU_ENUM_LABEL_VALUE_SWITCH_GPU_PROFILE)
-#endif
-
 DEFAULT_TITLE_SEARCH_FILTER_MACRO(action_get_title_deferred_history_list,   MENU_ENUM_LABEL_VALUE_LOAD_CONTENT_HISTORY)
 DEFAULT_TITLE_SEARCH_FILTER_MACRO(action_get_title_deferred_favorites_list, MENU_ENUM_LABEL_VALUE_GOTO_FAVORITES)
 DEFAULT_TITLE_SEARCH_FILTER_MACRO(action_get_title_deferred_images_list,    MENU_ENUM_LABEL_VALUE_GOTO_IMAGES)
@@ -1295,13 +1291,9 @@ static int menu_cbs_init_bind_title_compare_label(menu_file_list_cbs_t *cbs,
          action_get_title_core_directory},
       {MENU_ENUM_LABEL_LIBRETRO_INFO_PATH,
          action_get_title_core_info_directory},
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
       {MENU_ENUM_LABEL_SWITCH_CPU_PROFILE,
          action_get_title_switch_cpu_profile},
-#endif
-#ifdef HAVE_LAKKA_SWITCH
-      {MENU_ENUM_LABEL_SWITCH_GPU_PROFILE,
-         action_get_title_switch_gpu_profile},
 #endif
       {MENU_ENUM_LABEL_DEFERRED_MANUAL_CONTENT_SCAN_LIST,
          action_get_title_manual_content_scan_list},
@@ -1733,15 +1725,10 @@ static int menu_cbs_init_bind_title_compare_label(menu_file_list_cbs_t *cbs,
          case MENU_ENUM_LABEL_LIBRETRO_INFO_PATH:
             BIND_ACTION_GET_TITLE(cbs, action_get_title_core_info_directory);
             break;
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
          case MENU_ENUM_LABEL_SWITCH_CPU_PROFILE:
             BIND_ACTION_GET_TITLE(cbs, action_get_title_switch_cpu_profile);
             break;
-#endif
-#ifdef HAVE_LAKKA_SWITCH
-         case MENU_ENUM_LABEL_SWITCH_GPU_PROFILE:
-            BIND_ACTION_GET_TITLE(cbs, action_get_title_switch_gpu_profile);
-            break;
 #endif
          case MENU_ENUM_LABEL_MANUAL_CONTENT_SCAN_LIST:
             BIND_ACTION_GET_TITLE(cbs, action_get_title_manual_content_scan_list);
diff --git a/menu/drivers/ozone.c b/menu/drivers/ozone.c
index a4fb321b28..e32768298a 100644
--- a/menu/drivers/ozone.c
+++ b/menu/drivers/ozone.c
@@ -2041,10 +2041,7 @@ static uintptr_t ozone_entries_icon_get_texture(
       case MENU_ENUM_LABEL_USER_INTERFACE_SETTINGS:
       case MENU_ENUM_LABEL_SETTINGS_SHOW_USER_INTERFACE:
             return ozone->icons_textures[OZONE_ENTRIES_ICONS_TEXTURE_UI];
-#ifdef HAVE_LAKKA_SWITCH
-      case MENU_ENUM_LABEL_SWITCH_GPU_PROFILE:
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
       case MENU_ENUM_LABEL_SWITCH_CPU_PROFILE:
             return ozone->icons_textures[OZONE_ENTRIES_ICONS_TEXTURE_POWER];
 #endif
@@ -9230,7 +9227,7 @@ static int ozone_list_push(void *data, void *userdata,
                      false);
             }
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
             MENU_DISPLAYLIST_PARSE_SETTINGS_ENUM(
                   info->list,
                   MENU_ENUM_LABEL_SWITCH_CPU_PROFILE,
@@ -9238,14 +9235,6 @@ static int ozone_list_push(void *data, void *userdata,
                   false);
 #endif
 
-#ifdef HAVE_LAKKA_SWITCH
-            MENU_DISPLAYLIST_PARSE_SETTINGS_ENUM(
-                  info->list,
-                  MENU_ENUM_LABEL_SWITCH_GPU_PROFILE,
-                  PARSE_ACTION,
-                  false);
-#endif
-
             if (settings->bools.menu_show_configurations && !settings->bools.kiosk_mode_enable)
             {
                MENU_DISPLAYLIST_PARSE_SETTINGS_ENUM(
diff --git a/menu/drivers/xmb.c b/menu/drivers/xmb.c
index b23638aa4e..ee209822b1 100644
--- a/menu/drivers/xmb.c
+++ b/menu/drivers/xmb.c
@@ -3166,10 +3166,7 @@ static uintptr_t xmb_icon_get_id(xmb_handle_t *xmb,
       case MENU_ENUM_LABEL_USER_INTERFACE_SETTINGS:
       case MENU_ENUM_LABEL_SETTINGS_SHOW_USER_INTERFACE:
          return xmb->textures.list[XMB_TEXTURE_UI];
-#ifdef HAVE_LAKKA_SWITCH
-      case MENU_ENUM_LABEL_SWITCH_GPU_PROFILE:
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
       case MENU_ENUM_LABEL_SWITCH_CPU_PROFILE:
          return xmb->textures.list[XMB_TEXTURE_POWER];
 #endif
@@ -7916,22 +7913,13 @@ static int xmb_list_push(void *data, void *userdata,
                      false);
             }
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
             MENU_DISPLAYLIST_PARSE_SETTINGS_ENUM(
                   info->list,
                   MENU_ENUM_LABEL_SWITCH_CPU_PROFILE,
                   PARSE_ACTION,
                   false);
 #endif
-
-#ifdef HAVE_LAKKA_SWITCH
-            MENU_DISPLAYLIST_PARSE_SETTINGS_ENUM(
-                  info->list,
-                  MENU_ENUM_LABEL_SWITCH_GPU_PROFILE,
-                  PARSE_ACTION,
-                  false);
-#endif
-
             if (menu_show_configurations && !kiosk_mode_enable)
             {
                MENU_DISPLAYLIST_PARSE_SETTINGS_ENUM(
diff --git a/menu/menu_displaylist.c b/menu/menu_displaylist.c
index e5d9b1acb7..61ec8701a6 100644
--- a/menu/menu_displaylist.c
+++ b/menu/menu_displaylist.c
@@ -50,7 +50,7 @@
 #include "../core_updater_list.h"
 #endif
 
-#ifdef HAVE_LAKKA_SWITCH
+#ifdef HAVE_LAKKA
 #include "../../lakka.h"
 #endif
 
@@ -58,7 +58,7 @@
 #include <switch.h>
 #endif
 
-#if defined(HAVE_LAKKA) || defined(HAVE_LIBNX)
+#if /*defined(HAVE_LAKKA) ||*/ defined(HAVE_LIBNX)
 #include "../../switch_performance_profiles.h"
 #endif
 
@@ -11593,7 +11593,6 @@ bool menu_displaylist_ctl(enum menu_displaylist_ctl_state type,
          /* No-op */
          break;
 #endif
-#ifndef HAVE_LAKKA_SWITCH
 #ifdef HAVE_LAKKA
       case DISPLAYLIST_CPU_POLICY_LIST:
          menu_entries_ctl(MENU_ENTRIES_CTL_CLEAR, info->list);
@@ -11695,30 +11694,17 @@ bool menu_displaylist_ctl(enum menu_displaylist_ctl_state type,
          break;
       }
 #endif
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
       case DISPLAYLIST_SWITCH_CPU_PROFILE:
       {
          unsigned i;
          char text[PATH_MAX_LENGTH];
-#ifdef HAVE_LAKKA_SWITCH
-         char current_profile[PATH_MAX_LENGTH];
-         FILE               *profile = NULL;
-#endif
          const size_t profiles_count = sizeof(SWITCH_CPU_PROFILES)/sizeof(SWITCH_CPU_PROFILES[1]);
 
          runloop_msg_queue_push("Warning : extended overclocking can damage the Switch", 1, 90, true, NULL, MESSAGE_QUEUE_ICON_DEFAULT, MESSAGE_QUEUE_CATEGORY_INFO);
 
          menu_entries_ctl(MENU_ENTRIES_CTL_CLEAR, info->list);
 
-#ifdef HAVE_LAKKA_SWITCH
-         profile = popen("cpu-profile get", "r");
-         fgets(current_profile, PATH_MAX_LENGTH, profile);
-         pclose(profile);
-
-         snprintf(text, sizeof(text),
-               "Current profile: %s", current_profile);
-#else
          u32 currentClock = 0;
          if (hosversionBefore(8, 0, 0))
             pcvGetClockRate(PcvModule_CpuBus, &currentClock);
@@ -11730,7 +11716,6 @@ bool menu_displaylist_ctl(enum menu_displaylist_ctl_state type,
             clkrstCloseSession(&session);
          }
          snprintf(text, sizeof(text), "Current Clock : %i", currentClock);
-#endif
          if (menu_entries_append(info->list,
             text,
             "",
@@ -11760,49 +11745,7 @@ bool menu_displaylist_ctl(enum menu_displaylist_ctl_state type,
                             | MD_FLAG_NEED_CLEAR;
          break;
       }
-#if defined(HAVE_LAKKA_SWITCH)
-      case DISPLAYLIST_SWITCH_GPU_PROFILE:
-      {
-         unsigned i;
-         char text[PATH_MAX_LENGTH];
-         char current_profile[PATH_MAX_LENGTH];
-         FILE               *profile = NULL;
-         const size_t profiles_count = sizeof(SWITCH_GPU_PROFILES)/sizeof(SWITCH_GPU_PROFILES[1]);
-
-         runloop_msg_queue_push("Warning : extended overclocking can damage the Switch", 1, 90, true, NULL, MESSAGE_QUEUE_ICON_DEFAULT, MESSAGE_QUEUE_CATEGORY_INFO);
-
-         profile = popen("gpu-profile get", "r");
-         fgets(current_profile, PATH_MAX_LENGTH, profile);
-         pclose(profile);
-
-         menu_entries_ctl(MENU_ENTRIES_CTL_CLEAR, info->list);
-
-         /* TODO/FIXME - Localize */
-         snprintf(text, sizeof(text),
-               "Current profile : %s", current_profile);
-
-         if (menu_entries_append(info->list, text, "", 0, MENU_INFO_MESSAGE, 0, 0, NULL))
-            count++;
-
-         for (i = 0; i < profiles_count; i++)
-         {
-            char title[PATH_MAX_LENGTH];
-            char* profile               = SWITCH_GPU_PROFILES[i];
-            char* speed                 = SWITCH_GPU_SPEEDS[i];
-
-            snprintf(title, sizeof(title), "%s (%s)", profile, speed);
-
-            if (menu_entries_append(info->list, title, "", 0, MENU_SET_SWITCH_GPU_PROFILE, 0, i, NULL))
-               count++;
-         }
-
-         info->flags       |= MD_FLAG_NEED_REFRESH
-                            | MD_FLAG_NEED_PUSH
-                            | MD_FLAG_NEED_CLEAR;
-         break;
-      }
-#endif /* HAVE_LAKKA_SWITCH */
-#endif /* HAVE_LAKKA_SWITCH || HAVE_LIBNX */
+#endif /* HAVE_LIBNX */
       case DISPLAYLIST_MUSIC_LIST:
          {
             menu_entries_ctl(MENU_ENTRIES_CTL_CLEAR, info->list);
diff --git a/menu/menu_displaylist.h b/menu/menu_displaylist.h
index d6e52fd312..2f2da8df45 100644
--- a/menu/menu_displaylist.h
+++ b/menu/menu_displaylist.h
@@ -267,10 +267,7 @@ enum menu_displaylist_ctl_state
    DISPLAYLIST_CORE_CONTENT_DIRS,
    DISPLAYLIST_CORE_CONTENT_DIRS_SUBDIR,
    DISPLAYLIST_CORE_SYSTEM_FILES,
-#ifdef HAVE_LAKKA_SWITCH
-   DISPLAYLIST_SWITCH_GPU_PROFILE,
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
    DISPLAYLIST_SWITCH_CPU_PROFILE,
 #endif
    DISPLAYLIST_MANUAL_CONTENT_SCAN_LIST,
diff --git a/menu/menu_driver.c b/menu/menu_driver.c
index ab889b73c7..d2e02086f2 100644
--- a/menu/menu_driver.c
+++ b/menu/menu_driver.c
@@ -6746,11 +6746,9 @@ void menu_driver_toggle(
 

    if (on) 

    {

-#ifndef HAVE_LAKKA_SWITCH

 #ifdef HAVE_LAKKA

       set_cpu_scaling_signal(CPUSCALING_EVENT_FOCUS_MENU);

 #endif

-#endif /* #ifndef HAVE_LAKKA_SWITCH */

 #ifdef HAVE_OVERLAY

       /* If an overlay was displayed before the toggle

        * and overlays are disabled in menu, need to

@@ -6769,11 +6767,9 @@ void menu_driver_toggle(
    }

    else

    {

-#ifndef HAVE_LAKKA_SWITCH

 #ifdef HAVE_LAKKA

       set_cpu_scaling_signal(CPUSCALING_EVENT_FOCUS_CORE);

 #endif

-#endif /* #ifndef HAVE_LAKKA_SWITCH */

 #ifdef HAVE_OVERLAY

       /* Inhibits pointer 'select' and 'cancel' actions

        * (until the next time 'select'/'cancel' are released) */

diff --git a/menu/menu_driver.h b/menu/menu_driver.h
index e2ad966258..67c18b08b1 100644
--- a/menu/menu_driver.h
+++ b/menu/menu_driver.h
@@ -241,10 +241,7 @@ enum menu_settings_type
 
    MENU_SET_SCREEN_BRIGHTNESS,
 
-#ifdef HAVE_LAKKA_SWITCH
-   MENU_SET_SWITCH_GPU_PROFILE,
-#endif
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#if defined(HAVE_LIBNX)
    MENU_SET_SWITCH_CPU_PROFILE,
 #endif
 
diff --git a/menu/menu_setting.c b/menu/menu_setting.c
index a418f45879..e5ebce3991 100644
--- a/menu/menu_setting.c
+++ b/menu/menu_setting.c
@@ -8022,7 +8022,8 @@ static void general_write_handler(rarch_setting_t *setting)
             }
          }
          break;
-      case MENU_ENUM_LABEL_INPUT_POLL_TYPE_BEHAVIOR:
+
+     case MENU_ENUM_LABEL_INPUT_POLL_TYPE_BEHAVIOR:
          core_set_poll_type(*setting->value.target.integer);
          break;
       case MENU_ENUM_LABEL_VIDEO_SCALE_INTEGER:
@@ -9912,7 +9913,7 @@ static bool setting_append_list(
          MENU_SETTINGS_LIST_CURRENT_ADD_CMD(list, list_info, CMD_EVENT_QUIT);
 #endif
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
+#ifdef HAVE_LIBNX
         CONFIG_ACTION(
               list, list_info,
               MENU_ENUM_LABEL_SWITCH_CPU_PROFILE,
@@ -9923,7 +9924,7 @@ static bool setting_append_list(
 #endif
 
 #if defined(HAVE_LAKKA)
-#ifdef HAVE_LAKKA_SWITCH
+#if 0 /*def HAVE_LAKKA_SWITCH*/
         CONFIG_ACTION(
                list, list_info,
                MENU_ENUM_LABEL_SWITCH_GPU_PROFILE,
@@ -18488,7 +18489,6 @@ static bool setting_append_list(
 #endif
 
 #ifdef HAVE_LAKKA
-#ifndef HAVE_LAKKA_SWITCH
          CONFIG_ACTION(
                list, list_info,
                MENU_ENUM_LABEL_CPU_PERFPOWER,
@@ -18497,8 +18497,6 @@ static bool setting_append_list(
                &subgroup_info,
                parent_group);
 #endif
-#endif
-
          if (frontend_driver_has_gamemode())
             CONFIG_BOOL(
                   list, list_info,
diff --git a/switch_performance_profiles.h b/switch_performance_profiles.h
index 5d07ba6ed5..d51d645d3d 100644
--- a/switch_performance_profiles.h
+++ b/switch_performance_profiles.h
@@ -17,52 +17,9 @@
 #ifndef __SWITCH_PERFORMANCE_PROFILES_H
 #define __SWITCH_PERFORMANCE_PROFILES_H
 
-#if defined(HAVE_LAKKA_SWITCH) || defined(HAVE_LIBNX)
-#ifdef HAVE_LAKKA_SWITCH
-static char *SWITCH_GPU_PROFILES[] = {
-    "Docked Stock +2",
-    "Docked Stock +1",
-    "Docked Stock Mode",
-    "Handheld Boost +3",
-    "Handheld Boost +2",
-    "Handheld Boost +1",
-    "Handheld Boost Mode",
-    "Handheld Stock +1",
-    "Handheld Stock Mode",
-    "Powersaving +2",
-    "Powersaving +1",
-    "Powersaving Mode",
-};
-
-static char *SWITCH_GPU_SPEEDS[] = {
-    "921 Mhz",
-    "844 Mhz",
-    "768 Mhz",
-    "691 Mhz",
-    "614 Mhz",
-    "537 Mhz",
-    "460 Mhz",
-    "384 Mhz",
-    "307 Mhz",
-    "230 Mhz",
-    "153 Mhz",
-    "76 Mhz"
-};
-#endif
+#if defined(HAVE_LIBNX)
 
 static char *SWITCH_CPU_PROFILES[] = {
-#ifndef HAVE_LIBNX
-    "Max Overdrive +3",
-    "Max Overdrive +2",
-    "Max Overdrive +1",
-    "Maximum Performance",
-    "High Performance",
-    "Boost Performance",
-    "Stock Performance",
-    "Powersaving Mode 1",
-    "Powersaving Mode 2",
-    "Powersaving Mode 3",
-#else
     "Maximum Performance",
     "High Performance",
     "Boost Performance",
@@ -70,25 +27,12 @@ static char *SWITCH_CPU_PROFILES[] = {
     "Powersaving Mode 1",
     "Powersaving Mode 2",
     "Powersaving Mode 3",
-#endif
 };
 
 #define SWITCH_DEFAULT_CPU_PROFILE 3 /* Stock Performance */
 #define LIBNX_MAX_CPU_PROFILE 0 /* Max Performance */
 
 static char *SWITCH_CPU_SPEEDS[] = {
-#ifndef HAVE_LIBNX
-    " **UNSTABLE**  2091 MHz",
-    " **UNSTABLE**  1989 MHz",
-    " **UNSTABLE**  1887 MHz",
-    "1785 MHz",
-    "1581 MHz",
-    "1224 MHz",
-    "1020 MHz",
-    "918 MHz",
-    "816 MHz",
-    "714 MHz"
-#else
     "1785 MHz",
     "1581 MHz",
     "1224 MHz",
@@ -96,11 +40,8 @@ static char *SWITCH_CPU_SPEEDS[] = {
     "918 MHz",
     "816 MHz",
     "714 MHz"
-#endif
 };
 
-#ifdef HAVE_LIBNX
-// not used in switch-lakka
 static unsigned SWITCH_CPU_SPEEDS_VALUES[] = {
     1785000000,
     1581000000,
@@ -110,7 +51,6 @@ static unsigned SWITCH_CPU_SPEEDS_VALUES[] = {
     816000000,
     714000000
 };
-#endif
 
 #endif
 
-- 
2.35.1

